/* Copyright 2015 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 */
(function(){var t=function(){var n={};n.defaultNoDataValue=-34027999387901484e22;n.decode=function(f,e){e=e||{};var l=e.encodedMaskData||e.encodedMaskData===null,o=u(f,e.inputOffset||0,l),c=e.noDataValue!==null?e.noDataValue:n.defaultNoDataValue,h=t(o,e.pixelType||Float32Array,e.encodedMaskData,c,e.returnMask),s={width:o.width,height:o.height,pixelData:h.resultPixels,minValue:h.minValue,maxValue:o.pixels.maxValue,noDataValue:c};return h.resultMask&&(s.maskData=h.resultMask),e.returnEncodedMask&&o.mask&&(s.encodedMaskData=o.mask.bitset?o.mask.bitset:null),e.returnFileInfo&&(s.fileInfo=i(o),e.computeUsedBitDepths&&(s.fileInfo.bitDepths=r(o))),s};var t=function(n,t,i,r,u){var ot=0,d=n.pixels.numBlocksX,g=n.pixels.numBlocksY,rt=Math.floor(n.width/d),ut=Math.floor(n.height/g),st=2*n.maxZError,s=Number.MAX_VALUE,l,a,v,ft,h,c,p,w,b,y,it;for(i=i||(n.mask?n.mask.bitset:null),a=new t(n.width*n.height),u&&i&&(v=new Uint8Array(n.width*n.height)),ft=new Float32Array(rt*ut),p=0;p<=g;p++)if(w=p!==g?ut:n.height%g,w!==0)for(b=0;b<=d;b++)if(y=b!==d?rt:n.width%d,y!==0){var e=p*n.width*ut+b*rt,et=n.width-y,o=n.pixels.blocks[ot],nt,tt,k;if(o.encoding<2?(o.encoding===0?nt=o.rawData:(f(o.stuffedData,o.bitsPerPixel,o.numValidPixels,o.offset,st,ft,n.pixels.maxValue),nt=ft),tt=0):k=o.encoding===2?0:o.offset,i)for(c=0;c<w;c++){for(e&7&&(it=i[e>>3]<<(e&7)),h=0;h<y;h++)e&7||(it=i[e>>3]),it&128?(v&&(v[e]=1),l=o.encoding<2?nt[tt++]:k,s=s>l?l:s,a[e++]=l):(v&&(v[e]=0),a[e++]=r),it<<=1;e+=et}else if(o.encoding<2)for(c=0;c<w;c++){for(h=0;h<y;h++)l=nt[tt++],s=s>l?l:s,a[e++]=l;e+=et}else for(s=s>k?k:s,c=0;c<w;c++){for(h=0;h<y;h++)a[e++]=k;e+=et}if(o.encoding===1&&tt!==o.numValidPixels)throw"Block and Mask do not match";ot++}return{resultPixels:a,resultMask:v,minValue:s}},i=function(n){return{fileIdentifierString:n.fileIdentifierString,fileVersion:n.fileVersion,imageType:n.imageType,height:n.height,width:n.width,maxZError:n.maxZError,eofOffset:n.eofOffset,mask:n.mask?{numBlocksX:n.mask.numBlocksX,numBlocksY:n.mask.numBlocksY,numBytes:n.mask.numBytes,maxValue:n.mask.maxValue}:null,pixels:{numBlocksX:n.pixels.numBlocksX,numBlocksY:n.pixels.numBlocksY,numBytes:n.pixels.numBytes,maxValue:n.pixels.maxValue,noDataValue:n.noDataValue}}},r=function(n){for(var i,u=n.pixels.numBlocksX*n.pixels.numBlocksY,t={},r=0;r<u;r++)i=n.pixels.blocks[r],i.encoding===0?t.float32=!0:i.encoding===1?t[i.bitsPerPixel]=!0:t[0]=!0;return Object.keys(t)},u=function(n,t,i){var r={},et=new Uint8Array(n,t,10),u,l,k,it,w,b,o,rt,f,e,h,v,c,ut,y,ft;if(r.fileIdentifierString=String.fromCharCode.apply(null,et),r.fileIdentifierString.trim()!=="CntZImage")throw"Unexpected file identifier string: "+r.fileIdentifierString;if(t+=10,u=new DataView(n,t,24),r.fileVersion=u.getInt32(0,!0),r.imageType=u.getInt32(4,!0),r.height=u.getUint32(8,!0),r.width=u.getUint32(12,!0),r.maxZError=u.getFloat64(16,!0),t+=24,!i)if(u=new DataView(n,t,16),r.mask={},r.mask.numBlocksY=u.getUint32(0,!0),r.mask.numBlocksX=u.getUint32(4,!0),r.mask.numBytes=u.getUint32(8,!0),r.mask.maxValue=u.getFloat32(12,!0),t+=16,r.mask.numBytes>0){l=new Uint8Array(Math.ceil(r.width*r.height/8));u=new DataView(n,t,r.mask.numBytes);var s=u.getInt16(0,!0),a=2,p=0;do{if(s>0)while(s--)l[p++]=u.getUint8(a++);else for(k=u.getUint8(a++),s=-s;s--;)l[p++]=k;s=u.getInt16(a,!0);a+=2}while(a<r.mask.numBytes);if(s!==-32768||p<l.length)throw"Unexpected end of mask RLE encoding";r.mask.bitset=l;t+=r.mask.numBytes}else(r.mask.numBytes|r.mask.numBlocksY|r.mask.maxValue)==0&&(r.mask.bitset=new Uint8Array(Math.ceil(r.width*r.height/8)));u=new DataView(n,t,16);r.pixels={};r.pixels.numBlocksY=u.getUint32(0,!0);r.pixels.numBlocksX=u.getUint32(4,!0);r.pixels.numBytes=u.getUint32(8,!0);r.pixels.maxValue=u.getFloat32(12,!0);t+=16;var d=r.pixels.numBlocksX,g=r.pixels.numBlocksY,nt=d+(r.width%d>0?1:0),tt=g+(r.height%g>0?1:0);for(r.pixels.blocks=new Array(nt*tt),it=0,w=0;w<tt;w++)for(b=0;b<nt;b++){if(o=0,rt=n.byteLength-t,u=new DataView(n,t,Math.min(10,rt)),f={},r.pixels.blocks[it++]=f,e=u.getUint8(0),o++,f.encoding=e&63,f.encoding>3)throw"Invalid block encoding ("+f.encoding+")";if(f.encoding===2){t++;continue}if(e!==0&&e!==2){if(e>>=6,f.offsetType=e,e===2)f.offset=u.getInt8(1),o++;else if(e===1)f.offset=u.getInt16(1,!0),o+=2;else if(e===0)f.offset=u.getFloat32(1,!0),o+=4;else throw"Invalid block offset type";if(f.encoding===1)if(e=u.getUint8(o),o++,f.bitsPerPixel=e&63,e>>=6,f.numValidPixelsType=e,e===2)f.numValidPixels=u.getUint8(o),o++;else if(e===1)f.numValidPixels=u.getUint16(o,!0),o+=2;else if(e===0)f.numValidPixels=u.getUint32(o,!0),o+=4;else throw"Invalid valid pixel count type";}if(t+=o,f.encoding!==3)if(f.encoding===0){if(c=(r.pixels.numBytes-1)/4,c!==Math.floor(c))throw"uncompressed block has invalid length";h=new ArrayBuffer(c*4);v=new Uint8Array(h);v.set(new Uint8Array(n,t,c*4));ut=new Float32Array(h);f.rawData=ut;t+=c*4}else f.encoding===1&&(y=Math.ceil(f.numValidPixels*f.bitsPerPixel/8),ft=Math.ceil(y/4),h=new ArrayBuffer(ft*4),v=new Uint8Array(h),v.set(new Uint8Array(n,t,y)),f.stuffedData=new Uint32Array(h),t+=y)}return r.eofOffset=t,r},f=function(n,t,i,r,u,f,e){var l=(1<<t)-1,v=0,c,o=0,s,h,y=Math.ceil((e-r)/u),p=n.length*4-Math.ceil(t*i/8),a;for(n[n.length-1]<<=8*p,c=0;c<i;c++)o===0&&(h=n[v++],o=32),o>=t?(s=h>>>o-t&l,o-=t):(a=t-o,s=(h&l)<<a&l,h=n[v++],o=32-a,s+=h>>>o),f[c]=s<y?r+s*u:e;return f};return n}(),i=function(){"use strict";var t={unstuff:function(n,t,i,r,u,f,e,o){var a=(1<<i)-1,y=0,l,s=0,c,h,v,p,w=n.length*4-Math.ceil(i*r/8);if(n[n.length-1]<<=8*w,u)for(l=0;l<r;l++)s===0&&(h=n[y++],s=32),s>=i?(c=h>>>s-i&a,s-=i):(v=i-s,c=(h&a)<<v&a,h=n[y++],s=32-v,c+=h>>>s),t[l]=u[c];else for(p=Math.ceil((o-f)/e),l=0;l<r;l++)s===0&&(h=n[y++],s=32),s>=i?(c=h>>>s-i&a,s-=i):(v=i-s,c=(h&a)<<v&a,h=n[y++],s=32-v,c+=h>>>s),t[l]=c<p?f+c*e:o},unstuffLUT:function(n,t,i,r,u,f){var c=(1<<t)-1,v=0,h=0,l=0,e=0,o=0,s,a=[],p=n.length*4-Math.ceil(t*i/8),y;for(n[n.length-1]<<=8*p,y=Math.ceil((f-r)/u),h=0;h<i;h++)e===0&&(s=n[v++],e=32),e>=t?(o=s>>>e-t&c,e-=t):(l=t-e,o=(s&c)<<l&c,s=n[v++],e=32-l,o+=s>>>e),a[h]=o<y?r+o*u:f;return a.unshift(r),a},unstuff2:function(n,t,i,r,u,f,e,o){var y=(1<<i)-1,p=0,v,s=0,h=0,a,c,l,w;if(u)for(v=0;v<r;v++)s===0&&(c=n[p++],s=32,h=0),s>=i?(a=c>>>h&y,s-=i,h+=i):(l=i-s,a=c>>>h&y,c=n[p++],s=32-l,a|=(c&(1<<l)-1)<<i-l,h=l),t[v]=u[a];else for(w=Math.ceil((o-f)/e),v=0;v<r;v++)s===0&&(c=n[p++],s=32,h=0),s>=i?(a=c>>>h&y,s-=i,h+=i):(l=i-s,a=c>>>h&y,c=n[p++],s=32-l,a|=(c&(1<<l)-1)<<i-l,h=l),t[v]=a<w?f+a*e:o;return t},unstuffLUT2:function(n,t,i,r,u,f){for(var v=(1<<t)-1,y=0,l=0,o=0,e=0,s=0,h=0,c,a=[],p=Math.ceil((f-r)/u),l=0;l<i;l++)e===0&&(c=n[y++],e=32,h=0),e>=t?(s=c>>>h&v,e-=t,h+=t):(o=t-e,s=c>>>h&v,c=n[y++],e=32-o,s|=(c&(1<<o)-1)<<t-o,h=o),a[l]=s<p?r+s*u:f;return a.unshift(r),a},originalUnstuff:function(n,t,i,r){var s=(1<<i)-1,c=0,e,u=0,o,f,h,l=n.length*4-Math.ceil(i*r/8);for(n[n.length-1]<<=8*l,e=0;e<r;e++)u===0&&(f=n[c++],u=32),u>=i?(o=f>>>u-i&s,u-=i):(h=i-u,o=(f&s)<<h&s,f=n[c++],u=32-h,o+=f>>>u),t[e]=o;return t},originalUnstuff2:function(n,t,i,r){for(var c=(1<<i)-1,l=0,u=0,f=0,h,e,o,s=0;s<r;s++)u===0&&(e=n[l++],u=32,f=0),u>=i?(h=e>>>f&c,u-=i,f+=i):(o=i-u,h=e>>>f&c,e=n[l++],u=32-o,h|=(e&(1<<o)-1)<<i-o,f=o),t[s]=h;return t}},n={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(n){for(var t=65535,i=65535,e=n.length,r=Math.floor(e/2),u=0,f;r;){f=r>=359?359:r;r-=f;do t+=n[u++]<<8,i+=t+=n[u++];while(--f);t=(t&65535)+(t>>>16);i=(i&65535)+(i>>>16)}return e&1&&(i+=t+=n[u]<<8),t=(t&65535)+(t>>>16),i=(i&65535)+(i>>>16),(i<<16|t)>>>0},readHeaderInfo:function(n,t){var u=t.ptr,e=new Uint8Array(n,u,6),i={},r,f;if(i.fileIdentifierString=String.fromCharCode.apply(null,e),i.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+i.fileIdentifierString;if(u+=6,r=new DataView(n,u,52),i.fileVersion=r.getInt32(0,!0),u+=4,i.fileVersion>=3&&(i.checksum=r.getUint32(4,!0),u+=4),r=new DataView(n,u,48),i.height=r.getUint32(0,!0),i.width=r.getUint32(4,!0),i.numValidPixel=r.getUint32(8,!0),i.microBlockSize=r.getInt32(12,!0),i.blobSize=r.getInt32(16,!0),i.imageType=r.getInt32(20,!0),i.maxZError=r.getFloat64(24,!0),i.zMin=r.getFloat64(32,!0),i.zMax=r.getFloat64(40,!0),u+=48,t.headerInfo=i,t.ptr=u,i.fileVersion>=3&&(f=this.computeChecksumFletcher32(new Uint8Array(n,u-48,i.blobSize-14)),f!==i.checksum))throw"Checksum failed.";return!0},readMask:function(n,t){var e=t.ptr,l=t.headerInfo,o=l.width*l.height,a=l.numValidPixel,s=new DataView(n,e,4),i={},r,h,y,u;if(i.numBytes=s.getUint32(0,!0),e+=4,(0===a||o===a)&&0!==i.numBytes)throw"invalid mask";if(a===0)r=new Uint8Array(Math.ceil(o/8)),i.bitset=r,h=new Uint8Array(o),t.pixels.resultMask=h,e+=i.numBytes;else if(i.numBytes>0){r=new Uint8Array(Math.ceil(o/8));s=new DataView(n,e,i.numBytes);var f=s.getInt16(0,!0),c=2,v=0,p=0;do{if(f>0)while(f--)r[v++]=s.getUint8(c++);else for(p=s.getUint8(c++),f=-f;f--;)r[v++]=p;f=s.getInt16(c,!0);c+=2}while(c<i.numBytes);if(f!==-32768||v<r.length)throw"Unexpected end of mask RLE encoding";for(h=new Uint8Array(o),y=0,u=0,u=0;u<o;u++)y=u&7?r[u>>3]<<(u&7):r[u>>3],y&128&&(h[u]=1);t.pixels.resultMask=h;i.bitset=r;e+=i.numBytes}return t.ptr=e,t.mask=i,!0},readDataOneSweep:function(t,i,r){var e=i.ptr,o=i.headerInfo,h=o.width*o.height,v=o.imageType,s=o.numValidPixel*n.getDateTypeSize(v),f,c,l,a,u;if(r===Uint8Array?f=new Uint8Array(t,e,s):(c=new ArrayBuffer(s),l=new Uint8Array(c),l.set(new Uint8Array(t,e,s)),f=new r(c)),f.length===h)i.pixels.resultPixels=f;else for(i.pixels.resultPixels=new r(h),a=0,u=0,u=0;u<h;u++)i.pixels.resultMask[u]&&(i.pixels.resultPixels[u]=f[a++]);return e+=s,i.ptr=e,!0},readHuffman:function(t,r,u){var bt=r.headerInfo,ri=bt.width*bt.height,kt=this.HUFFMAN_LUT_BITS_MAX,ct=new DataView(t,r.ptr,16),dt,at,w,e,s,l,y,nt,pt,lt,ii,ht,ft,o,ot;if(r.ptr+=16,dt=ct.getInt32(0,!0),dt<2)throw"unsupported Huffman version";var it=ct.getInt32(4,!0),rt=ct.getInt32(8,!0),st=ct.getInt32(12,!0);if(rt>=st)return!1;for(at=new Uint32Array(st-rt),n.decodeBits(t,r,at),w=[],e=rt;e<st;e++)s=e-(e<it?0:it),w[s]={first:at[e-rt],second:null};var gt=t.byteLength-r.ptr,ui=Math.ceil(gt/4),ni=new ArrayBuffer(ui*4),fi=new Uint8Array(ni);fi.set(new Uint8Array(t,r.ptr,gt));var b=new Uint32Array(ni),f=0,p,a=0;for(p=b[0],e=rt;e<st;e++)s=e-(e<it?0:it),y=w[s].first,y>0&&(w[s].second=p<<f>>>32-y,32-f>=y?(f+=y,f===32&&(f=0,a++,p=b[a])):(f+=y-32,a++,p=b[a],w[s].second|=p>>>32-f));var ti=r.headerInfo.imageType===0?128:0,vt=r.headerInfo.height,ut=r.headerInfo.width,c=0,k=0,yt=new i;for(e=0;e<w.length;e++)w[e]!==undefined&&(c=Math.max(c,w[e].first));for(k=c>=kt?kt:c,c>=30&&console.log("WARning, large NUM LUT BITS IS "+c),nt=[],e=rt;e<st;e++)if(s=e-(e<it?0:it),y=w[s].first,y>0)if(pt=[y,s],y<=k)for(lt=w[s].second<<k-y,ii=1<<k-y,l=0;l<ii;l++)nt[lt|l]=pt;else for(lt=w[s].second,o=yt,ht=y-1;ht>=0;ht--)ft=lt>>>ht&1,ft?(o.right||(o.right=new i),o=o.right):(o.left||(o.left=new i),o=o.left),ht!==0||o.val||(o.val=pt[1]);var tt,d,wt=r.pixels.resultMask,h,v,et=0,g=0;if(f>0&&(a++,f=0),p=b[a],ot=new u(ri),r.headerInfo.numValidPixel===ut*vt)for(l=0,e=0;e<vt;e++)for(s=0;s<ut;s++,l++){if(tt=0,h=p<<f>>>32-k,v=h,32-f<k&&(h|=b[a+1]>>>64-f-k,v=h),nt[v])tt=nt[v][1],f+=nt[v][0];else for(h=p<<f>>>32-c,v=h,32-f<c&&(h|=b[a+1]>>>64-f-c,v=h),o=yt,g=0;g<c;g++)if(ft=h>>>c-g-1&1,o=ft?o.right:o.left,!(o.left||o.right)){tt=o.val;f=f+g+1;break}f>=32&&(f-=32,a++,p=b[a]);d=tt-ti;d+=s>0?et:e>0?ot[l-ut]:et;d&=255;ot[l]=d;et=d}else for(l=0,e=0;e<vt;e++)for(s=0;s<ut;s++,l++)if(wt[l]){if(tt=0,h=p<<f>>>32-k,v=h,32-f<k&&(h|=b[a+1]>>>64-f-k,v=h),nt[v])tt=nt[v][1],f+=nt[v][0];else for(h=p<<f>>>32-c,v=h,32-f<c&&(h|=b[a+1]>>>64-f-c,v=h),o=yt,g=0;g<c;g++)if(ft=h>>>c-g-1&1,o=ft?o.right:o.left,!(o.left||o.right)){tt=o.val;f=f+g+1;break}f>=32&&(f-=32,a++,p=b[a]);d=tt-ti;d+=s>0&&wt[l-1]?et:e>0&&wt[l-ut]?ot[l-ut]:et;d&=255;ot[l]=d;et=d}r.pixels.resultPixels=ot;r.ptr=r.ptr+(a+1)*4+(f>0?4:0)},decodeBits:function(n,i,r,u){var b=i.headerInfo.fileVersion,e=0,v=new DataView(n,i.ptr,5),k=v.getUint8(0),p,c,h,l,f,a,g,nt,w,rt,o;e++;var tt=k>>6,d=tt===0?4:3-tt,it=(k&32)>0?!0:!1,y=k&31,s=0;if(d===1)s=v.getUint8(e),e++;else if(d===2)s=v.getUint16(e,!0),e+=2;else if(d===4)s=v.getUint32(e,!0),e+=4;else throw"Invalid valid pixel count type";if(u=u||0,p=2*i.headerInfo.maxZError,it){for(i.counter.lut++,w=v.getUint8(e),rt=y,e++,f=Math.ceil((w-1)*y/8),a=Math.ceil(f/4),h=new ArrayBuffer(a*4),l=new Uint8Array(h),i.ptr+=e,l.set(new Uint8Array(n,i.ptr,f)),nt=new Uint32Array(h),i.ptr+=f,o=0;w-1>>>o;)o++;f=Math.ceil(s*o/8);a=Math.ceil(f/4);h=new ArrayBuffer(a*4);l=new Uint8Array(h);l.set(new Uint8Array(n,i.ptr,f));c=new Uint32Array(h);i.ptr+=f;g=b>=3?t.unstuffLUT2(nt,y,w-1,u,p,i.headerInfo.zMax):t.unstuffLUT(nt,y,w-1,u,p,i.headerInfo.zMax);b>=3?t.unstuff2(c,r,o,s,g):t.unstuff(c,r,o,s,g)}else i.counter.bitstuffer++,o=y,i.ptr+=e,o>0&&(f=Math.ceil(s*o/8),a=Math.ceil(f/4),h=new ArrayBuffer(a*4),l=new Uint8Array(h),l.set(new Uint8Array(n,i.ptr,f)),c=new Uint32Array(h),i.ptr+=f,b>=3?t.unstuff2(c,r,o,s,!1,u,p,i.headerInfo.zMax):t.unstuff(c,r,o,s,!1,u,p,i.headerInfo.zMax))},readTiles:function(t,i,r){var w=i.headerInfo,b=w.width,ht=w.height,o=w.microBlockSize,nt=w.imageType,tt=Math.ceil(b/o),it=Math.ceil(ht/o);i.pixels.numBlocksY=it;i.pixels.numBlocksX=tt;i.pixels.ptr=0;for(var f=0,e=0,p=0,a=0,c=0,h=0,ct=0,k=0,lt=0,at=0,u=0,l=0,v=0,rt=0,d=0,s=0,ut,vt,ft,yt,et,y,ot=new r(o*o),pt=ht%o||o,wt=b%o||o,st,g,p=0;p<it;p++)for(c=p!==it-1?o:pt,a=0;a<tt;a++){if(h=a!==tt-1?o:wt,u=p*b*o+a*o,l=b-h,ct=t.byteLength-i.ptr,ut=new DataView(t,i.ptr,Math.min(10,ct)),vt={},s=0,k=ut.getUint8(0),s++,lt=k>>6&255,at=k>>2&15,at!==(a*o>>3&15))throw"integrity issue";if(y=k&3,y>3){i.ptr+=s;throw"Invalid block encoding ("+y+")";}else if(y===2){i.counter.constant++;i.ptr+=s;continue}else if(y===0){if(i.counter.uncompressed++,i.ptr+=s,v=c*h*n.getDateTypeSize(nt),rt=t.byteLength-i.ptr,v=v<rt?v:rt,ft=new ArrayBuffer(v),yt=new Uint8Array(ft),yt.set(new Uint8Array(t,i.ptr,v)),et=new r(ft),d=0,i.pixels.resultMask)for(f=0;f<c;f++){for(e=0;e<h;e++)i.pixels.resultMask[u]&&(i.pixels.resultPixels[u]=et[d++]),u++;u+=l}else for(f=0;f<c;f++){for(e=0;e<h;e++)i.pixels.resultPixels[u++]=et[d++];u+=l}i.ptr+=d*n.getDateTypeSize(nt)}else if(st=n.getDataTypeUsed(nt,lt),g=n.getOnePixel(vt,s,st,ut),s+=n.getDateTypeSize(st),y===3)if(i.ptr+=s,i.counter.constantoffset++,i.pixels.resultMask)for(f=0;f<c;f++){for(e=0;e<h;e++)i.pixels.resultMask[u]&&(i.pixels.resultPixels[u]=g),u++;u+=l}else for(f=0;f<c;f++){for(e=0;e<h;e++)i.pixels.resultPixels[u++]=g;u+=l}else if(i.ptr+=s,n.decodeBits(t,i,ot,g),s=0,i.pixels.resultMask)for(f=0;f<c;f++){for(e=0;e<h;e++)i.pixels.resultMask[u]&&(i.pixels.resultPixels[u]=ot[s++]),u++;u+=l}else for(f=0;f<c;f++){for(e=0;e<h;e++)i.pixels.resultPixels[u++]=ot[s++];u+=l}}},formatFileInfo:function(t){return{fileIdentifierString:t.headerInfo.fileIdentifierString,fileVersion:t.headerInfo.fileVersion,imageType:t.headerInfo.imageType,height:t.headerInfo.height,width:t.headerInfo.width,numValidPixel:t.headerInfo.numValidPixel,microBlockSize:t.headerInfo.microBlockSize,blobSize:t.headerInfo.blobSize,maxZError:t.headerInfo.maxZError,pixelType:n.getPixelType(t.headerInfo.imageType),eofOffset:t.eofOffset,mask:t.mask?{numBytes:t.mask.numBytes}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,maxValue:t.headerInfo.zMax,minValue:t.headerInfo.zMin,noDataValue:t.noDataValue}}},constructConstantSurface:function(n){var i=n.headerInfo.zMax,r=n.headerInfo.height*n.headerInfo.width,t=0;if(n.pixels.resultMask)for(t=0;t<r;t++)n.pixels.resultMask[t]&&(n.pixels.resultPixels[t]=i);else for(t=0;t<r;t++)n.pixels.resultPixels[t]=i;return},getDataTypeArray:function(n){var t;switch(n){case 0:t=Int8Array;break;case 1:t=Uint8Array;break;case 2:t=Int16Array;break;case 3:t=Uint16Array;break;case 4:t=Int32Array;break;case 5:t=Uint32Array;break;case 6:t=Float32Array;break;case 7:t=Float64Array;break;default:t=Float32Array}return t},getPixelType:function(n){var t;switch(n){case 0:t="S8";break;case 1:t="U8";break;case 2:t="S16";break;case 3:t="U16";break;case 4:t="S32";break;case 5:t="U32";break;case 6:t="F32";break;case 7:t="F64";break;default:t="F32"}return t},isValidPixelValue:function(n,t){if(t===null||t===undefined)return!1;var i;switch(n){case 0:i=t>=-128&&t<=127;break;case 1:i=t>=0&&t<=255;break;case 2:i=t>=-32768&&t<=32767;break;case 3:i=t>=0&&t<=65536;break;case 4:i=t>=-2147483648&&t<=2147483647;break;case 5:i=t>=0&&t<=4294967296;break;case 6:i=t>=-34027999387901484e22&&t<=34027999387901484e22;break;case 7:i=t>=494065645841247e-338&&t<=17976931348623157e292;break;default:i=!1}return i},getDateTypeSize:function(n){var t=0;switch(n){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=n}return t},getDataTypeUsed:function(n,t){var i=n;switch(n){case 2:case 4:i=n-t;break;case 3:case 5:i=n-2*t;break;case 6:i=0===t?n:1===t?2:1;break;case 7:i=0===t?n:n-2*t+1;break;default:i=n}return i},getOnePixel:function(n,t,i,r){var u=0;switch(i){case 0:u=r.getInt8(t);break;case 1:u=r.getUint8(t);break;case 2:u=r.getInt16(t,!0);break;case 3:u=r.getUint16(t,!0);break;case 4:u=r.getInt32(t,!0);break;case 5:u=r.getUInt32(t,!0);break;case 6:u=r.getFloat32(t,!0);break;case 7:u=r.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type";}return u}},i=function(n,t,i){this.val=n;this.left=t;this.right=i};return{decode:function(t,i){var u,f,c,l,a,v,h,o,y;i=i||{};var p=i.maskData||i.maskData===null,s=i.noDataValue,e=0,r={};if(r.ptr=i.inputOffset||0,r.pixels={},n.readHeaderInfo(t,r)){if(u=r.headerInfo,f=n.getDataTypeArray(u.imageType),p)r.pixels.resultMask=i.maskData,r.ptr+=4;else if(!n.readMask(t,r))return;if(c=u.width*u.height,r.pixels.resultPixels=new f(c),r.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},u.numValidPixel!==0&&(u.zMax===u.zMin?n.constructConstantSurface(r):(l=new DataView(t,r.ptr,2),a=l.getUint8(0,!0),r.ptr++,a?n.readDataOneSweep(t,r,f):u.fileVersion>1&&u.imageType<=1&&Math.abs(u.maxZError-.5)<1e-5?(v=l.getUint8(1,!0),r.ptr++,v?n.readHuffman(t,r,f):n.readTiles(t,r,f)):n.readTiles(t,r,f))),r.eofOffset=r.ptr,i.inputOffset?(h=r.headerInfo.blobSize+i.inputOffset-r.ptr,Math.abs(h)>=1&&(r.eofOffset=i.inputOffset+r.headerInfo.blobSize)):(h=r.headerInfo.blobSize-r.ptr,Math.abs(h)>=1&&(r.eofOffset=r.headerInfo.blobSize)),o={width:u.width,height:u.height,pixelData:r.pixels.resultPixels,minValue:u.zMin,maxValue:u.zMax,maskData:r.pixels.resultMask},r.pixels.resultMask&&n.isValidPixelValue(u.imageType,s)){for(y=r.pixels.resultMask,e=0;e<c;e++)y[e]||(o.pixelData[e]=s);o.noDataValue=s}return r.noDataValue=s,i.returnFileInfo&&(o.fileInfo=n.formatFileInfo(r)),o}},getBandCount:function(t){var u=0,r=0,i={};for(i.ptr=0,i.pixels={};r<t.byteLength-58;)n.readHeaderInfo(t,i),r+=i.headerInfo.blobSize,u++,i.ptr=r;return u}}}(),n={decode:function(n,r){var u;r=r||{};var e=r.inputOffset||0,a=new Uint8Array(n,e,10),s=String.fromCharCode.apply(null,a),h;if(s.trim()==="CntZImage")h=t;else if(s.substring(0,5)==="Lerc2")h=i;else throw"Unexpected file identifier string: "+s;for(var o=0,v=n.byteLength-10,c,l,f={width:0,height:0,pixels:[],pixelType:r.pixelType,mask:null,statistics:[]};e<v;)u=h.decode(n,{inputOffset:e,encodedMaskData:c,maskData:l,returnMask:o===0?!0:!1,returnEncodedMask:o===0?!0:!1,returnFileInfo:!0,pixelType:r.pixelType||null,noDataValue:r.noDataValue||null}),e=u.fileInfo.eofOffset,o===0&&(c=u.encodedMaskData,l=u.maskData,f.width=u.width,f.height=u.height,f.pixelType=u.pixelType||u.fileInfo.pixelType,f.mask=u.maskData),o++,f.pixels.push(u.pixelData),f.statistics.push({minValue:u.minValue,maxValue:u.maxValue,noDataValue:u.noDataValue});return f}};typeof define=="function"&&define.amd?define([],function(){return n}):typeof module!="undefined"&&module.exports?module.exports=n:this.Lerc=n})();